<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ìœ„ì¸ í€´ì¦ˆ</title>
<style>
  body {
    font-family: "Noto Sans KR", sans-serif;
    text-align: center;
    background: #f9f9f9;
    padding: 20px;
  }
  h1 { background-color:#43f4ee; color: #f2ecec; margin-bottom: 10px; margin-left: 15px auto; margin-right: 15px auto;}
  img#quiz-image {
    width: 300px;
    height: 300px;
    object-fit: contain;
    border-radius: 8px;
    background: #e0e0e0;
    margin-bottom: 15px;
  }
  input#answer { padding: 8px; font-size: 16px; width: 220px; margin-right: 10px; }
  button { padding: 8px 12px; font-size: 16px; cursor: pointer; }
  #timer { font-weight:bold; color:red; margin-bottom:10px; }
  #hint { font-style: italic; color: #555; margin-bottom:15px; }
  #result { font-weight:bold; margin-top:10px; }
  #score { margin-top:10px; color: #333; }
</style>
</head>
<body>
<h1>ìœ„ì¸ í€´ì¦ˆ</h1>

<p id="timer"></p>
<p id="hint"></p>

<img id="quiz-image" src="" alt="ìœ„ì¸ ì‚¬ì§„" />

<div>
  <input id="answer" placeholder="ì´ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?" />
  <button onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
  <button onclick="resetQuiz()">ë‹¤ì‹œ í’€ê¸°</button>
</div>

<p id="result"></p>
<p id="score"></p>

<script>
let correctName = "";
let score = 0;
let timer;
let timeLeft = 12;
let questionCount = 0;
const totalQuestions = 6;

async function loadQuiz() {
  if (questionCount >= totalQuestions) {
    document.body.innerHTML = `<h2>ê²Œì„ ì¢…ë£Œ! ì ìˆ˜: ${score}/${totalQuestions}</h2>
                               <button onclick="resetQuiz()">ë‹¤ì‹œ ì‹œì‘</button>`;
    return;
  }

  const res = await fetch("/api/quiz");
  const data = await res.json();

  correctName = data.name;
  document.getElementById("quiz-image").src = data.imageUrl;
  document.getElementById("hint").textContent = `íŒíŠ¸: ${data.hint}`;
  document.getElementById("result").textContent = "";
  document.getElementById("answer").value = "";

  timeLeft = 12;
  startTimer();
  questionCount++;
}

function startTimer() {
  clearInterval(timer);
  timer = setInterval(() => {
    document.getElementById("timer").textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
    timeLeft--;
    if (timeLeft < 0) {
      clearInterval(timer);
      document.getElementById("result").textContent = `ì‹œê°„ ì´ˆê³¼! ì •ë‹µ: ${correctName}`;
      setTimeout(loadQuiz, 2000);
    }
  }, 1000);
}

function checkAnswer() {
  clearInterval(timer);
  const answer = document.getElementById("answer").value.trim();
  if (answer === correctName) {
    score++;
    document.getElementById("result").textContent = "ì •ë‹µ!";
  } else {
    document.getElementById("result").textContent = `í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µ: ${correctName}`;
  }
  document.getElementById("score").textContent = `ì ìˆ˜: ${score}`;
  setTimeout(loadQuiz, 2000);
}

// ğŸ”¹ ìƒˆ ê²Œì„ ì‹œì‘ ë²„íŠ¼
function resetQuiz() {
  score = 0;
  questionCount = 0;
  document.getElementById("score").textContent = `ì ìˆ˜: ${score}`;
  loadQuiz();
}

loadQuiz();
</script>
</body>
</html>
